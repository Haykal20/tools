<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haykal All-in-One Tools</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter & Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons: Lucide & Font Awesome -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- JS for TikTok Downloader -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <!-- JS for Tensor AI Detector -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>

    <style>
        /* General Body Style */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            touch-action: manipulation;
        }
        
        /* Custom Scrollbar for AI Chat */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1e293b; } /* Slate 800 */
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; } /* Slate 600 */
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #64748b; } /* Slate 500 */

        /* AI Chat Typing Indicator */
        .dot-flashing {
            position: relative; width: 10px; height: 10px;
            border-radius: 5px; background-color: #9ca3af;
            color: #9ca3af; animation: dotFlashing 1s infinite linear alternate;
            animation-delay: .5s;
        }
        .dot-flashing::before, .dot-flashing::after {
            content: ''; display: inline-block; position: absolute; top: 0;
        }
        .dot-flashing::before {
            left: -15px; width: 10px; height: 10px; border-radius: 5px;
            background-color: #9ca3af; color: #9ca3af;
            animation: dotFlashing 1s infinite alternate; animation-delay: 0s;
        }
        .dot-flashing::after {
            left: 15px; width: 10px; height: 10px; border-radius: 5px;
            background-color: #9ca3af; color: #9ca3af;
            animation: dotFlashing 1s infinite alternate; animation-delay: 1s;
        }
        @keyframes dotFlashing {
            0% { background-color: #9ca3af; }
            50%, 100% { background-color: #4b5563; }
        }
        
        /* TikTok Downloader Styles */
        .tiktok-tool-body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 42, 109, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(255, 42, 109, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 42, 109, 0); }
        }
        .slide-container { display: flex; overflow-x: auto; gap: 15px; padding: 15px 0; scrollbar-width: none; -ms-overflow-style: none; }
        .slide-container::-webkit-scrollbar { display: none; }
        .slide-image { min-width: 150px; height: 150px; object-fit: cover; border-radius: 12px; border: 3px solid #fff; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .slide-image:hover { transform: scale(1.08); box-shadow: 0 8px 16px rgba(0,0,0,0.3); }
        .video-preview-large, .slide-preview-large { width: 100%; height: 50vh; max-height: 600px; min-height: 300px; object-fit: contain; border-radius: 16px; background: #000; border: 3px solid #fff; box-shadow: 0 8px 24px rgba(0,0,0,0.3); }
        #tiktok-result { transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out; opacity: 0; transform: translateY(20px); pointer-events: none; }
        #tiktok-result.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
        
        /* General Tool Styles */
        .tool-body {
             background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }
        .tool-card {
             background: rgba(30, 41, 59, 0.5); /* Slate 800 with transparency */
             backdrop-filter: blur(10px);
             border: 1px solid rgba(51, 65, 85, 0.5); /* Slate 700 with transparency */
        }

        /* Fade-in animation for views */
        .view-enter {
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* Tensor AI Detector Styles */
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #fff;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-200 antialiased">

    <!-- Main App Container -->
    <div id="app-container" class="min-h-screen">

        <!-- ===== TOOL SELECTION VIEW (DEFAULT) ===== -->
        <div id="tool-selection-view" class="p-6 md:p-10 flex flex-col items-center justify-center min-h-screen">
            <header class="text-center mb-10">
                <h1 class="text-4xl md:text-5xl font-bold text-white tracking-tight">Haykal AIO Tools</h1>
                <p class="text-slate-400 mt-3 text-lg">Pilih alat yang ingin Anda gunakan di bawah ini.</p>
            </header>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 w-full max-w-6xl">
                <!-- AI Chat Card -->
                <div id="select-ai-chat" class="bg-slate-800 p-8 rounded-2xl border border-slate-700 hover:bg-slate-700/50 hover:border-teal-500 transition-all duration-300 cursor-pointer flex flex-col items-center text-center transform hover:-translate-y-2">
                    <div class="bg-teal-500/10 p-4 rounded-full mb-4 border border-teal-500/20"><i data-lucide="bot" class="w-10 h-10 text-teal-400"></i></div>
                    <h2 class="text-2xl font-bold text-white mb-2">Haykal AI Chat</h2>
                    <p class="text-slate-400">Asisten AI untuk menjawab pertanyaan Anda.</p>
                </div>
                <!-- TikTok Downloader Card -->
                <div id="select-tiktok-dl" class="bg-slate-800 p-8 rounded-2xl border border-slate-700 hover:bg-slate-700/50 hover:border-purple-500 transition-all duration-300 cursor-pointer flex flex-col items-center text-center transform hover:-translate-y-2">
                    <div class="bg-purple-500/10 p-4 rounded-full mb-4 border border-purple-500/20"><i class="fab fa-tiktok w-10 h-10 text-purple-400 text-4xl"></i></div>
                    <h2 class="text-2xl font-bold text-white mb-2">TikTok Downloader</h2>
                    <p class="text-slate-400">Unduh video & slideshow dari TikTok.</p>
                </div>
                <!-- Tensor AI Detector Card -->
                <div id="select-tensor-ai" class="bg-slate-800 p-8 rounded-2xl border border-slate-700 hover:bg-slate-700/50 hover:border-amber-500 transition-all duration-300 cursor-pointer flex flex-col items-center text-center transform hover:-translate-y-2">
                    <div class="bg-amber-500/10 p-4 rounded-full mb-4 border border-amber-500/20"><i data-lucide="scan-line" class="w-10 h-10 text-amber-400"></i></div>
                    <h2 class="text-2xl font-bold text-white mb-2">Detektor Objek AI</h2>
                    <p class="text-slate-400">Deteksi objek real-time dengan kamera.</p>
                </div>
                <!-- Number Converter Card -->
                <div id="select-num-converter" class="bg-slate-800 p-8 rounded-2xl border border-slate-700 hover:bg-slate-700/50 hover:border-sky-500 transition-all duration-300 cursor-pointer flex flex-col items-center text-center transform hover:-translate-y-2">
                    <div class="bg-sky-500/10 p-4 rounded-full mb-4 border border-sky-500/20"><i data-lucide="shuffle" class="w-10 h-10 text-sky-400"></i></div>
                    <h2 class="text-2xl font-bold text-white mb-2">Konverter Teks & Bilangan</h2>
                    <p class="text-slate-400">Konversi teks dan angka secara interaktif.</p>
                </div>
                <!-- Password Generator Card -->
                <div id="select-pw-generator" class="bg-slate-800 p-8 rounded-2xl border border-slate-700 hover:bg-slate-700/50 hover:border-rose-500 transition-all duration-300 cursor-pointer flex flex-col items-center text-center transform hover:-translate-y-2">
                    <div class="bg-rose-500/10 p-4 rounded-full mb-4 border border-rose-500/20"><i data-lucide="lock-keyhole" class="w-10 h-10 text-rose-400"></i></div>
                    <h2 class="text-2xl font-bold text-white mb-2">Generator Kata Sandi</h2>
                    <p class="text-slate-400">Buat kata sandi yang kuat dan aman.</p>
                </div>
            </div>
             <footer class="mt-12 text-center text-slate-500 text-sm">
                <p>Dibuat oleh <a href="#" class="font-semibold text-slate-400 hover:text-white">Haykalf.s</a></p>
             </footer>
        </div>

        <!-- ===== AI CHAT TOOL VIEW ===== -->
        <div id="ai-tool-view" class="hidden flex flex-col h-screen bg-gray-900">
             <!-- Header -->
            <header class="bg-gray-800/50 backdrop-blur-sm border-b border-gray-700 p-4 shadow-md flex items-center justify-between">
                <button class="back-to-selection-btn bg-slate-700 hover:bg-slate-600 p-2 rounded-full transition">
                    <i data-lucide="arrow-left" class="w-5 h-5 text-white"></i>
                </button>
                <div class="text-center">
                    <h1 class="text-xl font-bold text-white tracking-wider">Haykal AI</h1>
                     <select id="model-selector" class="bg-gray-700 border border-gray-600 text-white text-xs rounded-lg focus:ring-teal-500 focus:border-teal-500 block w-full p-1.5 transition mt-1">
                        <option value="deepseek/deepseek-chat-v3.1:free" selected>Deepseek Chat v3.1</option>
                        <option value="qwen/qwen3-4b:free">Qwen 3.5 4B</option>
                    </select>
                </div>
                <div class="w-9 h-9"></div> <!-- Spacer -->
            </header>

            <!-- Main Chat Area -->
            <main id="chat-container" class="flex-1 overflow-y-auto p-4 md:p-6 space-y-6 custom-scrollbar"></main>
            
            <!-- Typing Indicator -->
            <div id="loading-indicator" class="hidden px-6 pb-2">
                <div class="flex items-center gap-3">
                    <div class="bg-gray-700 p-2 rounded-full"><i data-lucide="bot" class="text-teal-400"></i></div>
                    <div class="bg-gray-800 rounded-lg p-4 flex items-center justify-center shadow"><div class="dot-flashing"></div></div>
                </div>
            </div>

            <!-- Input Form Area -->
            <footer class="p-4 md:p-6 bg-gray-900 border-t border-gray-700">
                <div class="max-w-3xl mx-auto">
                    <form id="chat-form" class="flex items-center gap-3">
                        <input type="text" id="user-input" placeholder="Ketik pesan Anda di sini..." autocomplete="off" class="flex-1 bg-gray-800 border border-gray-700 rounded-full px-5 py-3 text-sm text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-teal-500 transition duration-300">
                        <button type="submit" class="bg-teal-600 hover:bg-teal-500 text-white rounded-full p-3 flex items-center justify-center transition duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-teal-500 disabled:bg-gray-600 disabled:cursor-not-allowed">
                            <i data-lucide="send-horizontal" class="w-5 h-5"></i>
                        </button>
                    </form>
                </div>
            </footer>
        </div>
        
        <!-- Confirmation Modal for AI Chat Model Change -->
        <div id="confirmation-modal" class="hidden fixed inset-0 bg-black/60 items-center justify-center p-4 z-50">
             <div class="bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-sm border border-gray-700">
                <div class="text-center">
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-yellow-900/50">
                        <i data-lucide="alert-triangle" class="h-6 w-6 text-yellow-400"></i>
                    </div>
                    <h3 class="mt-4 text-lg font-medium text-white">Ganti Model?</h3>
                    <p class="mt-2 text-sm text-gray-400">Riwayat percakapan saat ini akan dihapus. Anda yakin ingin melanjutkan?</p>
                </div>
                <div class="mt-6 flex justify-end gap-3">
                    <button id="cancel-change-btn" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white text-sm font-medium rounded-md transition">Batal</button>
                    <button id="confirm-change-btn" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-md transition">Ya, Lanjutkan</button>
                </div>
            </div>
        </div>

        <!-- ===== TIKTOK DOWNLOADER TOOL VIEW ===== -->
        <div id="tiktok-tool-view" class="hidden min-h-screen tiktok-tool-body p-4">
             <div class="w-full max-w-4xl mx-auto">
                <button class="back-to-selection-btn mb-4 flex items-center gap-2 text-purple-200 hover:text-white transition">
                    <i class="fas fa-arrow-left"></i> Kembali ke Menu
                </button>
                <div class="glass-card rounded-2xl shadow-2xl overflow-hidden">
                    <div class="bg-gradient-to-r from-pink-500 to-purple-600 p-6 text-white text-center">
                        <div class="flex items-center justify-center gap-3 mb-2"><i class="fas fa-magic text-2xl"></i><h1 class="text-3xl font-bold">TikTok Downloader Pro</h1></div>
                        <p class="text-purple-100">Auto-Detect • Caption Saver • History by Haykalf.s</p>
                    </div>
                    <div class="p-6">
                        <div class="mb-6">
                            <label class="block text-white font-medium mb-2"><i class="fas fa-link"></i> TikTok URL</label>
                            <div class="relative flex items-center">
                                <input type="text" id="tiktok-url" placeholder="Tempel link TikTok di sini..." oninput="toggleClearButton()" class="w-full pl-4 pr-20 py-3 rounded-lg border-2 border-purple-300 focus:border-pink-500 focus:outline-none transition-colors bg-white/20 text-white placeholder-purple-200"/>
                                <div class="absolute right-2 flex items-center space-x-1">
                                    <button id="clear-btn" onclick="clearInput()" class="hidden text-white/50 hover:text-white transition-colors p-1 rounded-full"><i class="fas fa-times"></i></button>
                                    <button onclick="pasteFromClipboard()" class="bg-pink-500/50 hover:bg-pink-500 text-white font-semibold text-xs px-2 py-1 rounded-md transition-colors">Tempel</button>
                                </div>
                            </div>
                        </div>
                        <button onclick="downloadTikTok()" class="w-full bg-gradient-to-r from-pink-500 to-orange-500 hover:from-orange-500 hover:to-pink-500 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 pulse">
                            <i class="fas fa-download mr-2"></i><span>Download</span>
                        </button>
                        <div id="tiktok-loading" class="hidden mt-6 p-4 bg-blue-500/20 rounded-lg"><div class="flex items-center justify-center gap-3 text-blue-100"><i class="fas fa-spinner animate-spin"></i><span id="loadingText">Menganalisis URL...</span></div></div>
                        <div id="tiktok-error" class="hidden mt-6 p-4 bg-red-500/20 rounded-lg"><div class="flex items-center gap-2 text-red-100"><i class="fas fa-exclamation-triangle"></i><span id="errorMessage">Terjadi kesalahan</span></div></div>
                        <div id="tiktok-result" class="mt-6 space-y-6">
                             <div id="captionSection" class="hidden">
                                <div class="bg-gray-500/20 rounded-lg p-4 border border-gray-400/30">
                                    <h3 class="text-gray-100 font-semibold mb-2 flex items-center gap-2"><i class="fas fa-quote-left"></i> Caption</h3>
                                    <p id="captionText" class="text-gray-200 text-sm max-h-24 overflow-y-auto mb-3"></p>
                                    <button onclick="copyCaption()" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors text-sm"><i class="fas fa-copy mr-2"></i><span id="copyBtnText">Salin Caption</span></button>
                                </div>
                            </div>
                            <div id="videoSection" class="hidden"></div>
                            <div id="slideshowSection" class="hidden"></div>
                            <div id="profileSection" class="hidden"></div>
                        </div>
                    </div>
                </div>
                <div id="historyContainer" class="mt-6"></div>
            </div>
        </div>

        <!-- ===== TEXT & NUMBER CONVERTER TOOL VIEW ===== -->
        <div id="num-converter-view" class="hidden min-h-screen tool-body p-4 flex items-center justify-center">
             <div class="w-full max-w-2xl mx-auto">
                 <button class="back-to-selection-btn mb-4 flex items-center gap-2 text-slate-300 hover:text-white transition">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i> Kembali ke Menu
                </button>
                <div class="tool-card rounded-2xl shadow-2xl overflow-hidden">
                    <div class="p-6 bg-gradient-to-r from-sky-500 to-blue-600 text-white text-center">
                        <div class="flex items-center justify-center gap-3 mb-2"><i data-lucide="shuffle" class="w-7 h-7"></i><h1 class="text-3xl font-bold">Konverter Teks & Bilangan</h1></div>
                        <p class="text-sky-100">Konversi teks atau angka secara interaktif.</p>
                    </div>
                    <div class="p-6 space-y-4">
                        <!-- Text Input -->
                        <div>
                             <label for="text-input" class="block text-white font-medium mb-2">Teks (ASCII / UTF-8)</label>
                             <textarea id="text-input" placeholder="Ketik teks di sini..." class="w-full p-3 rounded-lg border-2 border-slate-600 focus:border-sky-500 focus:outline-none transition-colors bg-slate-900/50 text-white placeholder-slate-500 font-mono" rows="2"></textarea>
                        </div>
                        
                        <!-- Decimal -->
                        <div>
                            <label for="decimal-input" class="block text-white font-medium mb-2">Desimal</label>
                            <textarea id="decimal-input" placeholder="Angka desimal..." class="w-full p-3 rounded-lg border-2 border-slate-600 focus:border-sky-500 focus:outline-none transition-colors bg-slate-900/50 text-white placeholder-slate-500 font-mono" rows="2"></textarea>
                        </div>
                        <!-- Binary -->
                        <div>
                            <label for="binary-input" class="block text-white font-medium mb-2">Biner</label>
                            <textarea id="binary-input" placeholder="Angka biner..." class="w-full p-3 rounded-lg border-2 border-slate-600 focus:border-sky-500 focus:outline-none transition-colors bg-slate-900/50 text-white placeholder-slate-500 font-mono" rows="2"></textarea>
                        </div>
                        <!-- Hexadecimal -->
                        <div>
                            <label for="hex-input" class="block text-white font-medium mb-2">Heksadesimal</label>
                             <textarea id="hex-input" placeholder="Angka heksadesimal..." class="w-full p-3 rounded-lg border-2 border-slate-600 focus:border-sky-500 focus:outline-none transition-colors bg-slate-900/50 text-white placeholder-slate-500 font-mono" rows="2"></textarea>
                        </div>
                        <!-- Octal -->
                        <div>
                            <label for="octal-input" class="block text-white font-medium mb-2">Oktal</label>
                             <textarea id="octal-input" placeholder="Angka oktal..." class="w-full p-3 rounded-lg border-2 border-slate-600 focus:border-sky-500 focus:outline-none transition-colors bg-slate-900/50 text-white placeholder-slate-500 font-mono" rows="2"></textarea>
                        </div>
                         <button id="clear-converter-btn" class="w-full mt-2 bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                            <i data-lucide="trash-2" class="inline-block mr-2 w-4 h-4"></i>Bersihkan
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== PASSWORD GENERATOR TOOL VIEW ===== -->
        <div id="pw-generator-view" class="hidden min-h-screen tool-body p-4 flex items-center justify-center">
            <div class="w-full max-w-2xl mx-auto">
                 <button class="back-to-selection-btn mb-4 flex items-center gap-2 text-slate-300 hover:text-white transition">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i> Kembali ke Menu
                </button>
                <div class="tool-card rounded-2xl shadow-2xl overflow-hidden">
                     <div class="p-6 bg-gradient-to-r from-rose-500 to-red-600 text-white text-center">
                        <div class="flex items-center justify-center gap-3 mb-2"><i data-lucide="lock-keyhole" class="w-7 h-7"></i><h1 class="text-3xl font-bold">Generator Kata Sandi</h1></div>
                        <p class="text-rose-100">Buat kata sandi yang kuat untuk melindungi akun Anda.</p>
                    </div>
                    <div class="p-6 space-y-6">
                        <!-- Result -->
                        <div class="relative bg-slate-900/70 p-4 rounded-lg flex items-center">
                            <input id="password-output" type="text" readonly class="w-full bg-transparent text-white text-lg font-mono tracking-wider focus:outline-none" placeholder="Klik 'Buat' untuk memulai">
                            <button id="copy-password-btn" class="p-2 text-slate-400 hover:text-white transition"><i data-lucide="clipboard" class="w-5 h-5"></i></button>
                        </div>
                        <!-- Settings -->
                        <div class="space-y-4">
                            <!-- Length -->
                            <div class="flex items-center justify-between">
                                <label for="length-slider" class="text-white font-medium">Panjang Karakter</label>
                                <input id="length-display" type="number" value="16" class="w-16 p-1 text-center bg-slate-700 rounded text-white font-bold" min="4" max="64">
                            </div>
                            <input id="length-slider" type="range" min="4" max="64" value="16" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer">
                            <!-- Options -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                               <div class="flex items-center"><input id="uppercase" type="checkbox" checked class="w-4 h-4 accent-rose-500"><label for="uppercase" class="ml-2 text-white">Huruf Besar (A-Z)</label></div>
                               <div class="flex items-center"><input id="lowercase" type="checkbox" checked class="w-4 h-4 accent-rose-500"><label for="lowercase" class="ml-2 text-white">Huruf Kecil (a-z)</label></div>
                               <div class="flex items-center"><input id="numbers" type="checkbox" checked class="w-4 h-4 accent-rose-500"><label for="numbers" class="ml-2 text-white">Angka (0-9)</label></div>
                               <div class="flex items-center"><input id="symbols" type="checkbox" checked class="w-4 h-4 accent-rose-500"><label for="symbols" class="ml-2 text-white">Simbol (!@#$)</label></div>
                            </div>
                        </div>
                        <!-- Generate Button -->
                        <button id="generate-password-btn" class="w-full bg-gradient-to-r from-rose-500 to-pink-500 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105">
                            <i data-lucide="refresh-cw" class="inline-block mr-2 w-4 h-4"></i>Buat Kata Sandi
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== TENSOR AI DETECTOR TOOL VIEW ===== -->
        <div id="tensor-tool-view" class="hidden flex-col h-screen p-4 bg-gray-900 text-white">
            <div class="w-full max-w-2xl mx-auto h-full flex flex-col">
                 <button class="back-to-selection-btn mb-4 flex items-center gap-2 text-slate-300 hover:text-white transition self-start">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i> Kembali ke Menu
                </button>
                <!-- Header -->
                <header class="text-center mb-4">
                    <h1 class="text-2xl font-bold">Detektor Objek AI</h1>
                    <p id="tensor-status" class="text-sm text-gray-400">Klik tombol untuk memulai</p>
                </header>

                <!-- Camera Container -->
                <div class="flex-grow bg-black shadow-2xl rounded-2xl relative overflow-hidden flex items-center justify-center">
                    <!-- Video feed from camera -->
                    <video id="cameraFeed" playsinline autoplay muted class="absolute top-0 left-0 w-full h-full object-cover"></video>
                    <!-- Canvas for drawing detection results -->
                    <canvas id="canvas" class="absolute top-0 left-0 w-full h-full"></canvas>
                    
                    <!-- Start UI and Loading -->
                    <div id="start-ui" class="absolute inset-0 flex flex-col items-center justify-center bg-black/60 z-10">
                        <button id="startButton" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-lg shadow-lg transition-transform duration-200 active:scale-95">
                            Mulai Deteksi
                        </button>
                        <div id="loading" class="hidden flex-col items-center">
                            <div class="loader mb-4"></div>
                            <p>Memuat model AI, mohon tunggu...</p>
                        </div>
                         <p id="tensor-error-message" class="hidden mt-4 text-red-400 bg-red-900/50 p-3 rounded-lg"></p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- GLOBAL UI NAVIGATION SCRIPT ---
        const views = {
            selection: document.getElementById('tool-selection-view'),
            aiChat: document.getElementById('ai-tool-view'),
            tiktok: document.getElementById('tiktok-tool-view'),
            numConverter: document.getElementById('num-converter-view'),
            pwGenerator: document.getElementById('pw-generator-view'),
            tensor: document.getElementById('tensor-tool-view')
        };
        const buttons = {
            selectAiChat: document.getElementById('select-ai-chat'),
            selectTikTok: document.getElementById('select-tiktok-dl'),
            selectNumConverter: document.getElementById('select-num-converter'),
            selectPwGenerator: document.getElementById('select-pw-generator'),
            selectTensor: document.getElementById('select-tensor-ai'),
            back: document.querySelectorAll('.back-to-selection-btn')
        };
        function showView(viewToShow) {
            Object.values(views).forEach(view => view.classList.add('hidden'));
            viewToShow.classList.remove('hidden');
            viewToShow.classList.add('view-enter');
            window.scrollTo(0, 0);
            lucide.createIcons(); // Re-render icons on view change
        }
        buttons.selectAiChat.addEventListener('click', () => showView(views.aiChat));
        buttons.selectTikTok.addEventListener('click', () => showView(views.tiktok));
        buttons.selectNumConverter.addEventListener('click', () => showView(views.numConverter));
        buttons.selectPwGenerator.addEventListener('click', () => showView(views.pwGenerator));
        buttons.selectTensor.addEventListener('click', () => showView(views.tensor));
        buttons.back.forEach(btn => btn.addEventListener('click', () => showView(views.selection)));

        // --- INITIALIZE ICONS ---
        lucide.createIcons();

        // --- AI CHAT SCRIPT ---
        (() => {
            const API_URL = "https://restless-fire-59dc.thehaykal219.workers.dev";
            const chatContainer = document.getElementById('chat-container');
            const chatForm = document.getElementById('chat-form');
            const userInput = document.getElementById('user-input');
            const loadingIndicator = document.getElementById('loading-indicator');
            const submitButton = chatForm.querySelector('button');
            const modelSelector = document.getElementById('model-selector');
            const confirmationModal = document.getElementById('confirmation-modal');
            const confirmChangeBtn = document.getElementById('confirm-change-btn');
            const cancelChangeBtn = document.getElementById('cancel-change-btn');
            let messages = [];
            let currentModel = modelSelector.value;
            let isFirstMessage = true;
            chatForm.addEventListener('submit', handleFormSubmit);
            modelSelector.addEventListener('change', handleModelChange);
            confirmChangeBtn.addEventListener('click', confirmModelChange);
            cancelChangeBtn.addEventListener('click', cancelModelChange);
            buttons.selectAiChat.addEventListener('click', () => {
                if(isFirstMessage) {
                    appendSystemMessage('Halo! Saya Haykal AI. Silakan ajukan pertanyaan apa pun!');
                    isFirstMessage = false;
                }
            });
            function handleModelChange() {
                if (messages.length === 0) { confirmModelChange(); return; }
                confirmationModal.style.display = 'flex';
            }
            function confirmModelChange() {
                messages = [];
                chatContainer.innerHTML = '';
                const modelName = modelSelector.options[modelSelector.selectedIndex].text;
                appendSystemMessage(`Model diubah ke ${modelName}. Percakapan dimulai ulang.`);
                userInput.focus();
                currentModel = modelSelector.value;
                confirmationModal.style.display = 'none';
            }
            function cancelModelChange() {
                modelSelector.value = currentModel;
                confirmationModal.style.display = 'none';
            }
            async function handleFormSubmit(e) {
                e.preventDefault();
                const userMessage = userInput.value.trim();
                if (!userMessage) return;
                appendMessage('user', userMessage);
                messages.push({ role: 'user', content: userMessage });
                userInput.value = '';
                setFormDisabled(true);
                loadingIndicator.classList.remove('hidden');
                scrollToBottom();
                try {
                    const aiResponse = await getAIResponse(modelSelector.value);
                    appendMessage('assistant', aiResponse);
                    messages.push({ role: 'assistant', content: aiResponse });
                } catch (error) {
                    console.error("Error:", error);
                    appendMessage('assistant', "Maaf, terjadi kesalahan. Coba lagi.", true);
                } finally {
                    loadingIndicator.classList.add('hidden');
                    setFormDisabled(false);
                }
            }
            async function getAIResponse(model) {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ model, messages })
                });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status} - ${errorData.error}`);
                }
                const data = await response.json();
                return data.choices[0].message.content;
            }
            function appendMessage(sender, text, isError = false) {
                const msgWrapper = document.createElement('div'), msgContent = document.createElement('div'), iconDiv = document.createElement('div');
                iconDiv.className = 'bg-gray-700 p-2 rounded-full self-start';
                msgWrapper.className = 'flex items-start gap-3';
                msgContent.className = 'rounded-lg p-3 max-w-lg shadow';
                msgContent.style.whiteSpace = 'pre-wrap';
                msgContent.textContent = text;
                if (sender === 'user') {
                    msgWrapper.classList.add('justify-end');
                    msgContent.classList.add('bg-teal-600', 'text-white');
                    iconDiv.innerHTML = `<i data-lucide="user" class="text-white"></i>`;
                    msgWrapper.append(msgContent, iconDiv);
                } else {
                    msgContent.classList.add(isError ? 'bg-red-800' : 'bg-gray-800');
                    iconDiv.innerHTML = `<i data-lucide="bot" class="text-teal-400"></i>`;
                    msgWrapper.append(iconDiv, msgContent);
                }
                chatContainer.appendChild(msgWrapper);
                lucide.createIcons();
                scrollToBottom();
            }
            function appendSystemMessage(text) {
                 const wrapper = document.createElement('div');
                 wrapper.className = 'text-center my-2';
                 const content = document.createElement('div');
                 content.className = 'inline-block bg-gray-700 text-gray-400 text-xs px-3 py-1 rounded-full';
                 content.textContent = text;
                 wrapper.appendChild(content);
                 chatContainer.appendChild(wrapper);
                 scrollToBottom();
            }
            function scrollToBottom() { chatContainer.scrollTop = chatContainer.scrollHeight; }
            function setFormDisabled(isDisabled) {
                userInput.disabled = isDisabled;
                submitButton.disabled = isDisabled;
                userInput.placeholder = isDisabled ? "AI sedang berpikir..." : "Ketik pesan Anda di sini...";
                if (!isDisabled) userInput.focus();
            }
        })();

        // --- TIKTOK DOWNLOADER SCRIPT ---
        (() => {
            let currentSlides = [];
            let currentCaption = "";
            window.hideAllResultSections = function() {
                document.getElementById('tiktok-result').classList.remove('visible');
                ['captionSection', 'videoSection', 'slideshowSection', 'profileSection', 'tiktok-error'].forEach(id => document.getElementById(id).classList.add('hidden'));
            }
            window.pasteFromClipboard = async function() {
                try {
                    document.getElementById('tiktok-url').value = await navigator.clipboard.readText();
                    toggleClearButton();
                } catch (err) { console.error('Gagal membaca clipboard: ', err); }
            }
            window.toggleClearButton = function() {
                document.getElementById('clear-btn').classList.toggle('hidden', !document.getElementById('tiktok-url').value);
            }
            window.clearInput = function() {
                document.getElementById('tiktok-url').value = '';
                toggleClearButton();
            }
            window.downloadTikTok = async function() {
                const urlInput = document.getElementById('tiktok-url').value.trim();
                let url = urlInput.startsWith('@') ? `https://www.tiktok.com/${urlInput}` : urlInput;
                const loading = document.getElementById('tiktok-loading');
                const error = document.getElementById('tiktok-error');
                const errorMessage = document.getElementById('errorMessage');
                if (!url) { errorMessage.textContent = 'Tolong masukkan URL TikTok!'; error.classList.remove('hidden'); return; }
                hideAllResultSections();
                loading.classList.remove('hidden');
                try {
                    document.getElementById('loadingText').textContent = 'Menghubungi server...';
                    const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(`https://www.tikwm.com/api/?url=${encodeURIComponent(url)}`)}`);
                    if (!response.ok) throw new Error(`Network error: ${response.status}`);
                    document.getElementById('loadingText').textContent = 'Menerima data...';
                    const resultData = JSON.parse((await response.json()).contents);
                    if (resultData.code !== 0) throw new Error(resultData.msg || 'Gagal mengekstrak konten.');
                    const content = resultData.data;
                    let contentFound = false;
                    currentCaption = content.title || "";
                    if (currentCaption) { document.getElementById('captionText').textContent = currentCaption; document.getElementById('captionSection').classList.remove('hidden'); }
                    if (content.images && content.images.length > 0) {
                        document.getElementById('videoSection').innerHTML = '';
                        document.getElementById('slideshowSection').innerHTML = createSlideshowHTML();
                        displaySlideshow(content);
                        document.getElementById('slideshowSection').classList.remove('hidden');
                        contentFound = true;
                        saveToHistory({ url: urlInput, title: content.title, thumbnail: content.cover, type: 'slideshow' });
                    } else if (content.play) {
                        document.getElementById('slideshowSection').innerHTML = '';
                        document.getElementById('videoSection').innerHTML = createVideoHTML();
                        displayVideo(content);
                        document.getElementById('videoSection').classList.remove('hidden');
                        contentFound = true;
                        saveToHistory({ url: urlInput, title: content.title, thumbnail: content.cover, type: 'video' });
                    }
                    if (content.author?.unique_id) {
                        document.getElementById('profileSection').innerHTML = createProfileHTML();
                        displayProfile(content.author);
                        document.getElementById('profileSection').classList.remove('hidden');
                    } else if (content.unique_id && !contentFound) {
                        document.getElementById('profileSection').innerHTML = createProfileHTML();
                        displayProfile(content);
                        document.getElementById('profileSection').classList.remove('hidden');
                        contentFound = true;
                        saveToHistory({ url: urlInput, title: `@${content.unique_id}`, thumbnail: content.avatar, type: 'profile' });
                    }
                    if (contentFound) { document.getElementById('tiktok-result').classList.add('visible'); } 
                    else { throw new Error('Tidak ada konten yang dapat diunduh.'); }
                } catch (err) {
                    errorMessage.textContent = `Error: ${err.message}`;
                    error.classList.remove('hidden');
                } finally {
                    loading.classList.add('hidden');
                }
            }
            window.copyCaption = function() {
                navigator.clipboard.writeText(currentCaption).then(() => {
                    const btnText = document.getElementById('copyBtnText');
                    btnText.textContent = 'Berhasil disalin!';
                    setTimeout(() => { btnText.textContent = 'Salin Caption'; }, 2000);
                });
            }
            const createVideoHTML = () => `<div class="bg-green-500/20 rounded-lg p-4 border border-green-400/30"><h3 class="text-green-100 font-semibold mb-4 flex items-center gap-2"><i class="fas fa-video"></i> Video Terdeteksi</h3><video id="preview" controls class="video-preview-large mb-4"></video><div class="grid grid-cols-1 md:grid-cols-2 gap-3"><a id="videoLink" download href="#" target="_blank" class="flex items-center justify-center gap-2 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-medium py-3 px-4 rounded-lg"><i class="fas fa-video"></i> Unduh Video</a><a id="audioLink" download href="#" target="_blank" class="flex items-center justify-center gap-2 bg-gradient-to-r from-purple-500 to-indigo-500 text-white font-medium py-3 px-4 rounded-lg"><i class="fas fa-music"></i> Unduh Audio</a></div></div>`;
            const createSlideshowHTML = () => `<div class="bg-yellow-500/20 rounded-lg p-4 border border-yellow-400/30"><h3 class="text-yellow-100 font-semibold mb-4 flex items-center gap-2"><i class="fas fa-images"></i> Slideshow Terdeteksi</h3><div class="mb-6"><img id="slidePreviewLarge" alt="Slide Preview" class="slide-preview-large mx-auto"><div class="flex justify-center mt-3"><span id="currentSlideInfo" class="text-yellow-200 text-sm"></span></div></div><div class="slide-container" id="slidesContainer"></div><div class="mt-4"><button onclick="downloadSlidesAsZip()" class="w-full bg-gradient-to-r from-yellow-500 to-orange-500 text-white font-bold py-3 px-4 rounded-lg"><i class="fas fa-file-archive mr-2"></i> Unduh Semua (ZIP)</button></div></div>`;
            const createProfileHTML = () => `<div class="bg-indigo-500/20 rounded-lg p-4 border border-indigo-400/30"><h3 class="text-indigo-100 font-semibold mb-3 flex items-center gap-2"><i class="fas fa-user-circle"></i> Informasi Profil</h3><div class="flex items-center gap-4 mb-4"><img id="profileImage" alt="Profile" class="w-24 h-24 rounded-full border-4 border-white shadow-xl"><div class="min-w-0"><p id="username" class="text-white font-bold text-xl break-words"></p><p id="nickname" class="text-indigo-200 text-sm break-words"></p><p id="followers" class="text-indigo-300 text-xs mt-1"></p></div></div><a id="profileDownloadLink" download href="#" target="_blank" class="inline-flex items-center justify-center gap-2 bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-bold py-3 px-6 rounded-lg"><i class="fas fa-user"></i> Unduh Foto Profil</a></div>`;
            const displayVideo = (video) => { document.getElementById('preview').src = video.play; document.getElementById('videoLink').href = video.play; const audioLink = document.getElementById('audioLink'); audioLink.href = video.music; audioLink.classList.toggle('hidden', !video.music); }
            const displaySlideshow = (slideshow) => {
                currentSlides = slideshow.images || [];
                document.getElementById('slidePreviewLarge').src = currentSlides[0] || '';
                document.getElementById('currentSlideInfo').textContent = `Slide 1 dari ${currentSlides.length}`;
                const container = document.getElementById('slidesContainer');
                container.innerHTML = currentSlides.map((url, i) => `<img src="${url}" alt="Slide ${i + 1}" class="slide-image" onclick="changeSlide(${i})">`).join('');
                if (container.firstChild) container.firstChild.style.border = '3px solid #ff2a6d';
            }
            window.changeSlide = (index) => {
                document.getElementById('slidePreviewLarge').src = currentSlides[index];
                document.getElementById('currentSlideInfo').textContent = `Slide ${index + 1} dari ${currentSlides.length}`;
                document.querySelectorAll('.slide-image').forEach((thumb, i) => thumb.style.border = i === index ? '3px solid #ff2a6d' : '3px solid #fff');
            }
            window.downloadSlidesAsZip = async function() {
                const zip = new JSZip();
                const promises = currentSlides.map(async (url, index) => {
                    const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                    const blob = await (await fetch(JSON.parse(await response.text()).contents)).blob();
                    zip.file(`image_${index + 1}.jpeg`, blob);
                });
                await Promise.all(promises);
                zip.generateAsync({ type: 'blob' }).then(content => {
                    saveAs(content, 'tiktok_slideshow.zip');
                });
            }
            const displayProfile = (author) => {
                document.getElementById('profileImage').src = author.avatar || '';
                document.getElementById('username').textContent = `@${author.unique_id || 'unknown'}`;
                document.getElementById('nickname').textContent = author.nickname || 'No name';
                document.getElementById('followers').textContent = author.follower_count ? `${formatNumber(author.follower_count)} followers` : '';
                document.getElementById('profileDownloadLink').href = author.avatar || '#';
            }
             const formatNumber = (num) => {
                if (num >= 1000000) return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'K';
                return num.toString();
            }
            const saveToHistory = (item) => {
                let history = JSON.parse(localStorage.getItem('tiktokHistory')) || [];
                history = history.filter(h => h.url !== item.url);
                history.unshift({ ...item, timestamp: new Date().getTime() });
                if (history.length > 5) history.pop();
                localStorage.setItem('tiktokHistory', JSON.stringify(history));
                loadHistory();
            }
            const loadHistory = () => {
                const history = JSON.parse(localStorage.getItem('tiktokHistory')) || [];
                const container = document.getElementById('historyContainer');
                if (history.length === 0) { container.innerHTML = ''; return; }
                let historyHTML = `<div class="glass-card rounded-2xl p-4 mt-6"><div class="flex justify-between items-center mb-3"><h3 class="text-white font-semibold"><i class="fas fa-history mr-2"></i>Riwayat Terakhir</h3><button onclick="clearHistory()" class="text-purple-300 hover:text-white text-sm">Bersihkan</button></div><div class="space-y-2">`;
                history.forEach(item => {
                    const icon = item.type === 'video' ? 'fa-video' : item.type === 'slideshow' ? 'fa-images' : 'fa-user';
                    historyHTML += `<div onclick="reuseUrl('${item.url}')" class="flex items-center gap-3 p-2 rounded-lg bg-white/10 hover:bg-white/20 cursor-pointer transition-colors"><img src="${item.thumbnail}" onerror="this.src='https://placehold.co/40x40/ff2a6d/white?text=?';" class="w-10 h-10 rounded-md object-cover flex-shrink-0"><div class="min-w-0"><p class="text-white text-sm font-medium truncate">${item.title || item.url}</p><p class="text-purple-300 text-xs"><i class="fas ${icon} mr-1"></i> ${item.type}</p></div></div>`;
                });
                historyHTML += `</div></div>`;
                container.innerHTML = historyHTML;
            }
            window.reuseUrl = (url) => { document.getElementById('tiktok-url').value = url; toggleClearButton(); downloadTikTok(); }
            window.clearHistory = () => { localStorage.removeItem('tiktokHistory'); loadHistory(); }
            buttons.selectTikTok.addEventListener('click', loadHistory);
        })();
        
        // --- TEXT & NUMBER CONVERTER SCRIPT ---
        (() => {
            const inputs = {
                text: document.getElementById('text-input'),
                dec: document.getElementById('decimal-input'),
                bin: document.getElementById('binary-input'),
                hex: document.getElementById('hex-input'),
                oct: document.getElementById('octal-input')
            };
            const clearBtn = document.getElementById('clear-converter-btn');
            let activeInput = null;
            const updateAll = (source, value) => {
                if (activeInput !== source) return;
                let textVal = '', decVal = '', binVal = '', hexVal = '', octVal = '';
                if (source === 'text') {
                    if(value) {
                       for (const char of value) {
                            const charCode = char.charCodeAt(0);
                            decVal += charCode + ' ';
                            binVal += charCode.toString(2).padStart(8, '0') + ' ';
                            hexVal += charCode.toString(16).toUpperCase().padStart(2, '0') + ' ';
                            octVal += charCode.toString(8).padStart(3, '0') + ' ';
                        }
                    }
                    textVal = value;
                } else {
                    const cleanedValue = value.replace(/\s+/g, '');
                    if(cleanedValue) {
                        const baseMap = { dec: 10, bin: 2, hex: 16, oct: 8 };
                        const numbers = cleanedValue.match(/[0-9a-fA-F]+/g) || [];
                        try {
                           const decValues = numbers.map(numStr => parseInt(numStr, baseMap[source]));
                           if (decValues.some(isNaN)) throw new Error("Invalid number");
                            decValues.forEach(dec => {
                                if (dec >= 0 && dec <= 0x10FFFF) { textVal += String.fromCodePoint(dec); }
                                decVal += dec + ' ';
                                binVal += dec.toString(2).padStart(8, '0') + ' ';
                                hexVal += dec.toString(16).toUpperCase().padStart(2, '0') + ' ';
                                octVal += dec.toString(8).padStart(3, '0') + ' ';
                            });
                        } catch (e) {
                             Object.keys(inputs).forEach(key => { if(key !== source && key !== 'text') inputs[key].value = ''; });
                             inputs.text.value = 'Error';
                             return;
                        }
                    }
                }
                if (source !== 'text') inputs.text.value = textVal.trim();
                if (source !== 'dec') inputs.dec.value = decVal.trim();
                if (source !== 'bin') inputs.bin.value = binVal.trim();
                if (source !== 'hex') inputs.hex.value = hexVal.trim();
                if (source !== 'oct') inputs.oct.value = octVal.trim();
            };
            Object.entries(inputs).forEach(([name, element]) => {
                element.addEventListener('focus', () => activeInput = name);
                element.addEventListener('input', (e) => updateAll(name, e.target.value));
            });
            clearBtn.addEventListener('click', () => {
                Object.values(inputs).forEach(input => input.value = '');
            });
        })();

        // --- PASSWORD GENERATOR SCRIPT ---
        (() => {
            const display = document.getElementById('password-output');
            const lengthSlider = document.getElementById('length-slider');
            const lengthDisplay = document.getElementById('length-display');
            const options = { uppercase: document.getElementById('uppercase'), lowercase: document.getElementById('lowercase'), numbers: document.getElementById('numbers'), symbols: document.getElementById('symbols') };
            const generateBtn = document.getElementById('generate-password-btn');
            const copyBtn = document.getElementById('copy-password-btn');
            const charSets = { uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', lowercase: 'abcdefghijklmnopqrstuvwxyz', numbers: '0123456789', symbols: '!@#$%^&*()_+~`|}{[]:;?><,./-=' };
            const generatePassword = () => {
                const length = parseInt(lengthSlider.value);
                let charset = Object.keys(options).filter(key => options[key].checked).map(key => charSets[key]).join('');
                if (charset === '') { display.value = 'Pilih minimal satu opsi'; return; }
                let password = '';
                for (let i = 0; i < length; i++) password += charset[Math.floor(Math.random() * charset.length)];
                display.value = password;
            };
            const copyPassword = () => {
                if (!display.value || display.value.startsWith('Pilih')) return;
                navigator.clipboard.writeText(display.value).then(() => {
                    copyBtn.innerHTML = `<i data-lucide="check" class="w-5 h-5 text-green-400"></i>`;
                    lucide.createIcons();
                    setTimeout(() => { copyBtn.innerHTML = `<i data-lucide="clipboard" class="w-5 h-5"></i>`; lucide.createIcons(); }, 1500);
                });
            };
            lengthSlider.addEventListener('input', () => lengthDisplay.value = lengthSlider.value);
            lengthDisplay.addEventListener('input', () => {
                let value = Math.min(64, Math.max(4, parseInt(lengthDisplay.value) || 4));
                lengthDisplay.value = value;
                lengthSlider.value = value;
            });
            generateBtn.addEventListener('click', generatePassword);
            copyBtn.addEventListener('click', copyPassword);
            buttons.selectPwGenerator.addEventListener('click', generatePassword);
        })();

        // --- TENSOR AI DETECTOR SCRIPT ---
        (() => {
            const tensorView = document.getElementById('tensor-tool-view');
            if (!tensorView) return;

            const video = tensorView.querySelector('#cameraFeed');
            const canvas = tensorView.querySelector('#canvas');
            const context = canvas.getContext('2d');
            const startButton = tensorView.querySelector('#startButton');
            const startUI = tensorView.querySelector('#start-ui');
            const loadingUI = tensorView.querySelector('#loading');
            const statusText = tensorView.querySelector('#tensor-status');
            const errorMessage = tensorView.querySelector('#tensor-error-message');
            const backButton = tensorView.querySelector('.back-to-selection-btn');
            
            let model = null;
            let lastSpoken = '';
            let speakTimeout = null;
            let stream = null;
            let animationFrameId = null;

            const kamusIndonesia = {
                person: 'orang', bicycle: 'sepeda', car: 'mobil', motorcycle: 'sepeda motor',
                airplane: 'pesawat', bus: 'bis', train: 'kereta', truck: 'truk', boat: 'perahu',
                'traffic light': 'lampu lalu lintas', 'fire hydrant': 'hidran', 'stop sign': 'rambu berhenti',
                'parking meter': 'meteran parkir', bench: 'bangku', bird: 'burung', cat: 'kucing',
                dog: 'anjing', horse: 'kuda', sheep: 'domba', cow: 'sapi', elephant: 'gajah',
                bear: 'beruang', zebra: 'zebra', giraffe: 'jerapah', backpack: 'ransel',
                umbrella: 'payung', handbag: 'tas tangan', tie: 'dasi', suitcase: 'koper',
                frisbee: 'frisbee', skis: 'ski', snowboard: 'papan seluncur', 'sports ball': 'bola',
                kite: 'layang-layang', 'baseball bat': 'tongkat bisbol', 'baseball glove': 'sarung tangan bisbol',
                skateboard: 'papan luncur', surfboard: 'papan selancar', 'tennis racket': 'raket tenis',
                bottle: 'botol', 'wine glass': 'gelas anggur', cup: 'gelas', fork: 'garpu',
                knife: 'pisau', spoon: 'sendok', bowl: 'mangkuk', banana: 'pisang', apple: 'apel',
                sandwich: 'roti lapis', orange: 'jeruk', broccoli: 'brokoli', carrot: 'wortel',
                'hot dog': 'hot dog', pizza: 'pizza', donut: 'donat', cake: 'kue', chair: 'kursi',
                couch: 'sofa', 'potted plant': 'tanaman pot', bed: 'tempat tidur', 'dining table': 'meja makan',
                toilet: 'toilet', tv: 'televisi', laptop: 'laptop', mouse: 'mouse', remote: 'remote',
                keyboard: 'keyboard', 'cell phone': 'ponsel', microwave: 'microwave', oven: 'oven',
                toaster: 'pemanggang roti', sink: 'wastafel', refrigerator: 'kulkas', book: 'buku',
                clock: 'jam', vase: 'vas', scissors: 'gunting', 'teddy bear': 'boneka beruang',
                'hair drier': 'pengering rambut', toothbrush: 'sikat gigi'
            };
            
            function stopDetection() {
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                    stream = null;
                }
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
                window.speechSynthesis.cancel();
                startUI.classList.remove('hidden');
                startButton.classList.remove('hidden');
                loadingUI.classList.add('hidden');
                errorMessage.classList.add('hidden');
                statusText.textContent = "Klik tombol untuk memulai";
                context.clearRect(0, 0, canvas.width, canvas.height);
                video.srcObject = null;
            }

            backButton.addEventListener('click', stopDetection);
            
            function speak(text) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'id-ID';
                utterance.rate = 1.0;
                window.speechSynthesis.speak(utterance);
            }
            
            async function runDetection() {
                if (!model || !stream || !video.srcObject) return;
                const predictions = await model.detect(video);
                
                const aspectRatio = video.videoWidth / video.videoHeight;
                let canvasWidth, canvasHeight;

                if (canvas.parentElement.clientWidth / canvas.parentElement.clientHeight > aspectRatio) {
                    canvasWidth = canvas.parentElement.clientHeight * aspectRatio;
                    canvasHeight = canvas.parentElement.clientHeight;
                } else {
                    canvasWidth = canvas.parentElement.clientWidth;
                    canvasHeight = canvas.parentElement.clientWidth / aspectRatio;
                }
                canvas.width = canvasWidth;
                canvas.height = canvasHeight;

                context.clearRect(0, 0, canvas.width, canvas.height);
                context.font = '16px Inter';
                context.textBaseline = 'top';

                predictions.forEach(prediction => {
                    const [x, y, width, height] = prediction.bbox.map(val => val * (canvas.width / video.videoWidth));
                    const translatedClass = kamusIndonesia[prediction.class] || prediction.class;
                    const score = Math.round(prediction.score * 100);

                    context.strokeStyle = '#00FFFF';
                    context.lineWidth = 2;
                    context.strokeRect(x, y, width, height);

                    context.fillStyle = '#00FFFF';
                    const text = `${translatedClass} (${score}%)`;
                    const textWidth = context.measureText(text).width;
                    context.fillRect(x, y, textWidth + 8, 24);
                    
                    context.fillStyle = '#000000';
                    context.fillText(text, x + 4, y + 4);
                });

                if (predictions.length > 0) {
                    const topPrediction = predictions.reduce((prev, current) => (prev.score > current.score) ? prev : current);
                    const translatedClass = kamusIndonesia[topPrediction.class] || topPrediction.class;

                    if (topPrediction.score > 0.65 && translatedClass !== lastSpoken) {
                        lastSpoken = translatedClass;
                        clearTimeout(speakTimeout);
                        speakTimeout = setTimeout(() => {
                            speak(`Ini ${translatedClass}`);
                        }, 500);
                    }
                } else {
                    lastSpoken = '';
                }

                animationFrameId = requestAnimationFrame(runDetection);
            }
            
            startButton.addEventListener('click', async () => {
                startButton.classList.add('hidden');
                errorMessage.classList.add('hidden');
                loadingUI.classList.remove('hidden');
                statusText.textContent = "Memuat model AI...";

                try {
                    if (!model) {
                       model = await cocoSsd.load();
                    }
                    statusText.textContent = "Mengaktifkan kamera...";
                    
                    stream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            facingMode: 'environment',
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        }
                    });
                    video.srcObject = stream;

                    video.onloadedmetadata = () => {
                        startUI.classList.add('hidden');
                        statusText.textContent = "Arahkan kamera ke objek";
                        runDetection();
                    };

                } catch (err) {
                    console.error("Error:", err);
                    statusText.textContent = "Gagal memuat. Coba lagi.";
                    errorMessage.textContent = "Gagal memulai kamera/model. Pastikan Anda memberi izin kamera & menggunakan koneksi HTTPS.";
                    errorMessage.classList.remove('hidden');
                    startButton.classList.remove('hidden');
                    loadingUI.classList.add('hidden');
                }
            });
        })();

    </script>
</body>
</html>

